{"ast":null,"code":"import _classCallCheck from \"/Users/prd/Documents/_git/_personal/adleading/react-base/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/prd/Documents/_git/_personal/adleading/react-base/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/prd/Documents/_git/_personal/adleading/react-base/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/prd/Documents/_git/_personal/adleading/react-base/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/prd/Documents/_git/_personal/adleading/react-base/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/prd/Documents/_git/_personal/adleading/react-base/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/prd/Documents/_git/_personal/adleading/react-base/src/root.js\";\nimport React, { Component } from 'react';\nimport { getUserinfo, getSession, wx_auth } from './config/request';\nimport { setShare } from './config';\nimport { getStore, setStore } from 'mulan-lib';\nimport bg1Img from \"./lib/img/bg.png\";\nimport songImg from \"./lib/img/song.png\";\nimport songGImg from \"./lib/img/song_g.png\";\nimport songOgg from './lib/s.mp3';\n\nvar Root =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Root, _Component);\n\n  function Root(props) {\n    var _this;\n\n    _classCallCheck(this, Root);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Root).call(this, props));\n    var sessionId = getStore('sessionId', 'session');\n    var userinfo = getStore('userinfo', 'session');\n    var location = props.location;\n    var query = location.query;\n    var code = query.code,\n        _query$recomId = query.recomId,\n        recomId = _query$recomId === void 0 ? '' : _query$recomId;\n\n    var setUserInfo = function setUserInfo(_ref) {\n      var code = _ref.code,\n          data = _ref.data;\n\n      if (code === '9999') {\n        var member = data.member;\n        setStore('userinfo', member, 'session');\n      } else {\n        console.log('授权失败');\n      }\n    };\n\n    if (!(sessionId && userinfo.nickName)) {\n      if (!code) {\n        window.location.replace(wx_auth(recomId));\n        return _possibleConstructorReturn(_this);\n      }\n\n      getSession(code, recomId).then(function (_ref2) {\n        var data = _ref2.data,\n            isSuccess = _ref2.isSuccess;\n\n        if (isSuccess) {\n          var api_u_key = data.api_u_key;\n          setStore('sessionId', api_u_key, 'session');\n          getUserinfo(api_u_key).then(setUserInfo);\n        } else {\n          window.location.replace(wx_auth(recomId));\n        }\n      });\n    } else {\n      getUserinfo(sessionId).then(setUserInfo);\n    }\n\n    _this.state = {\n      play: false\n    };\n    _this.handlePlay = _this.handlePlay.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(Root, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      // this.handlePlay()\n      setTimeout(function () {\n        // document.getElementById('voice').play()\n        // try {\n        // document.querySelector('.musicPlay').click()\n        // } catch(e) {\n        //   alert(e)\n        // }\n        // if (!window.isIOS()) {\n        _this2.setState({\n          play: true\n        }); // }\n        // document.querySelector('.musicPlay').play()\n\n      }, 1000); //\n    }\n  }, {\n    key: \"handlePlay\",\n    value: function handlePlay() {\n      var play = this.state.play;\n      var music = document.getElementById('voice');\n\n      if (play) {\n        music.pause();\n        this.setState({\n          play: false\n        });\n      } else {\n        music.play();\n        this.setState({\n          play: true\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var children = this.props.children;\n      var play = this.state.play;\n      return React.createElement(\"div\", {\n        className: \"root\",\n        style: {\n          backgroundImage: \"url(\".concat(bg1Img, \")\"),\n          backgroundSize: \"cover\",\n          width: \"100%\",\n          height: \"100%\" // transform: 'translateY(-.07rem)'\n\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 86\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          textAlign: 'right',\n          position: 'absolute',\n          zIndex: '999',\n          left: '3.3rem',\n          top: '.05rem',\n          overflow: 'hidden'\n        },\n        id: \"test_abc\",\n        className: \"musicPlay\",\n        onClick: this.handlePlay,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95\n        },\n        __self: this\n      }, React.createElement(\"audio\", {\n        style: {\n          position: 'absolute',\n          width: \"1px\",\n          height: '1px'\n        },\n        src: songOgg,\n        controls: true,\n        loop: true,\n        id: \"voice\",\n        preload: \"preload\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103\n        },\n        __self: this\n      }), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: play ? songImg : songGImg,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104\n        },\n        __self: this\n      }))), children);\n    }\n  }]);\n\n  return Root;\n}(Component);\n\nexport default Root;","map":{"version":3,"sources":["/Users/prd/Documents/_git/_personal/adleading/react-base/src/root.js"],"names":["React","Component","getUserinfo","getSession","wx_auth","setShare","getStore","setStore","bg1Img","songImg","songGImg","songOgg","Root","props","sessionId","userinfo","location","query","code","recomId","setUserInfo","data","member","console","log","nickName","window","replace","then","isSuccess","api_u_key","state","play","handlePlay","bind","setTimeout","setState","music","document","getElementById","pause","children","backgroundImage","backgroundSize","width","height","textAlign","position","zIndex","left","top","overflow"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { getUserinfo, getSession, wx_auth } from './config/request'\nimport { setShare } from './config'\nimport { getStore, setStore } from 'mulan-lib'\nimport bg1Img from \"./lib/img/bg.png\";\nimport songImg from \"./lib/img/song.png\";\nimport songGImg from \"./lib/img/song_g.png\";\nimport songOgg from './lib/s.mp3'\n\nclass Root extends Component {\n  constructor(props) {\n    super(props)\n\n    const sessionId = getStore('sessionId', 'session')\n    const userinfo = getStore('userinfo', 'session')\n    const { location } = props\n    const { query } = location\n    const { code, recomId = '' } = query\n\n    const setUserInfo = ({ code, data }) => {\n\n      if(code === '9999') {\n        const { member } = data\n        setStore('userinfo', member, 'session')\n\n      } else {\n        console.log('授权失败')\n      }\n    }\n\n    if (!(sessionId && userinfo.nickName)) {\n      if(!code) {\n        window.location.replace(wx_auth(recomId))\n        return\n      }\n      getSession(code, recomId).then(({ data, isSuccess }) => {\n        if (isSuccess) {\n          const { api_u_key } = data\n          setStore('sessionId', api_u_key, 'session')\n          getUserinfo(api_u_key).then(setUserInfo)\n        } else {\n          window.location.replace(wx_auth(recomId))\n        }\n      })\n    } else {\n      getUserinfo(sessionId).then(setUserInfo)\n    }\n    this.state = {\n      play: false\n    }\n    this.handlePlay = this.handlePlay.bind(this)\n  }\n  componentDidMount() {\n    // this.handlePlay()\n    setTimeout(()=>{\n      // document.getElementById('voice').play()\n      // try {\n        // document.querySelector('.musicPlay').click()\n      // } catch(e) {\n      //   alert(e)\n      // }\n      // if (!window.isIOS()) {\n        this.setState({ play: true })\n      // }\n        // document.querySelector('.musicPlay').play()\n    }, 1000)\n    //\n  }\n  handlePlay() {\n    const { play } = this.state\n\n    let music = document.getElementById('voice')\n    if (play) {\n      music.pause()\n      this.setState({ play: false })\n    } else {\n      music.play()\n      this.setState({ play: true })\n    }\n\n  }\n  render() {\n    const { children } = this.props\n    const { play } = this.state\n    return (\n      <div className='root'\n      style={{\n        backgroundImage: `url(${bg1Img})`,\n        backgroundSize: \"cover\",\n        width: \"100%\",\n        height: \"100%\",\n        // transform: 'translateY(-.07rem)'\n      }}>\n\n      <div  style={{\n        textAlign: 'right',\n        position: 'absolute',\n        zIndex: '999',\n        left: '3.3rem',\n        top: '.05rem',\n        overflow: 'hidden'\n      }} id='test_abc' className=\"musicPlay\" onClick={ this.handlePlay }>\n          <audio style={{ position: 'absolute', width: \"1px\", height:'1px' }} src={ songOgg } controls loop id='voice' preload=\"preload\" ></audio>\n          <p><img src={ play ? songImg : songGImg }  /></p>\n      </div>\n\n      { children }\n      </div>\n    )\n  }\n}\n\nexport default Root\n"]},"metadata":{},"sourceType":"module"}